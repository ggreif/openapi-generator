{{#models}}
{{#imports}}
{{#isMap}}import { type Map } "mo:core/pure/Map";
{{/isMap}}{{^isMappedType}}
import { type {{import}}; JSON = {{import}} } "./{{import}}";
{{/isMappedType}}
{{/imports}}
{{#model}}{{#vendorExtensions.x-has-unsigned-fields}}
import Int "mo:core/Int";
{{/vendorExtensions.x-has-unsigned-fields}}

{{#isEnum}}
// {{classname}}.mo
{{#description}}
/// {{{description}}}
{{/description}}
/// Enum values: {{#allowableValues}}{{#enumVars}}#{{name}}{{^-last}}, {{/-last}}{{/enumVars}}{{/allowableValues}}

module {
    // User-facing type: type-safe variants for application code
    public type {{classname}} = {
{{#allowableValues}}
{{#enumVars}}
        {{#enumDescription}}
        /// {{{enumDescription}}}
        {{/enumDescription}}
        #{{name}};
{{/enumVars}}
{{/allowableValues}}
    };

    // JSON sub-module: everything needed for JSON serialization
    public module JSON {
        // JSON-facing Motoko type: mirrors JSON structure
        // Named "JSON" to avoid shadowing the outer {{classname}} type
        public type JSON = {{dataType}};

        // Convert User-facing type to JSON-facing Motoko type
        public func toJSON(value : {{classname}}) : JSON =
            switch (value) {
{{#allowableValues}}
{{#enumVars}}
                case (#{{name}}) {{#isString}}"{{value}}"{{/isString}}{{^isString}}{{value}}{{/isString}};
{{/enumVars}}
{{/allowableValues}}
            };

        // Convert JSON-facing Motoko type to User-facing type
        public func fromJSON(json : JSON) : ?{{classname}} =
            switch (json) {
{{#allowableValues}}
{{#enumVars}}
                case {{#isString}}"{{value}}"{{/isString}}{{^isString}}{{value}}{{/isString}} ?#{{name}};
{{/enumVars}}
{{/allowableValues}}
                case _ null;
            };
    }
}
{{/isEnum}}
{{^isEnum}}
{{#vendorExtensions.x-is-oneof}}
// {{classname}}.mo
{{#description}}
/// {{{description}}}
{{/description}}

module {
    // User-facing type: discriminated union (oneOf)
    public type {{classname}} = {
{{#vendorExtensions.oneOfVariants}}
        {{#hasType}}#{{name}} : {{dataType}}{{/hasType}}{{^hasType}}#{{name}}{{/hasType}};
{{/vendorExtensions.oneOfVariants}}
    };

    // JSON sub-module: everything needed for JSON serialization
    public module JSON {
        // Convert oneOf variant to Text for URL parameters
        public func toText(value : {{classname}}) : Text =
            switch (value) {
{{#vendorExtensions.oneOfVariants}}
                case ({{#hasType}}#{{name}}(v){{/hasType}}{{^hasType}}#{{name}}{{/hasType}}) {{#hasType}}{{#isNumericType}}Int.toText(v){{/isNumericType}}{{#isEnumType}}{{dataType}}.toJSON(v){{/isEnumType}}{{#isObjectType}}debug_show(v){{/isObjectType}}{{/hasType}}{{^hasType}}"{{enumValue}}"{{/hasType}};
{{/vendorExtensions.oneOfVariants}}
            };

        // JSON-facing Motoko type: mirrors JSON structure
        // Named "JSON" to avoid shadowing the outer {{classname}} type
        public type JSON = {
{{#vendorExtensions.oneOfVariants}}
            {{#hasType}}#{{name}} : {{jsonType}}{{/hasType}}{{^hasType}}#{{name}}{{/hasType}};
{{/vendorExtensions.oneOfVariants}}
        };

        // Convert User-facing type to JSON-facing Motoko type
        public func toJSON(value : {{classname}}) : JSON =
            switch (value) {
{{#vendorExtensions.oneOfVariants}}
                case ({{#hasType}}#{{name}}(v){{/hasType}}{{^hasType}}#{{name}}{{/hasType}}) {{#hasType}}#{{name}}{{#needsConversion}}(v){{/needsConversion}}{{^needsConversion}}(v){{/needsConversion}}{{/hasType}}{{^hasType}}#{{name}}{{/hasType}};
{{/vendorExtensions.oneOfVariants}}
            };

        // Convert JSON-facing Motoko type to User-facing type
        public func fromJSON(json : JSON) : ?{{classname}} =
            switch (json) {
{{#vendorExtensions.oneOfVariants}}
                case ({{#hasType}}#{{name}}(v){{/hasType}}{{^hasType}}#{{name}}{{/hasType}}) {{#hasType}}{{#isUnsigned}}if (v < 0) null else ?#{{name}}(Int.abs(v)){{/isUnsigned}}{{^isUnsigned}}?#{{name}}(v){{/isUnsigned}}{{/hasType}}{{^hasType}}?#{{name}}{{/hasType}};
{{/vendorExtensions.oneOfVariants}}
            };
    }
}
{{/vendorExtensions.x-is-oneof}}
{{^vendorExtensions.x-is-oneof}}
// {{classname}}.mo
{{#description}}
/// {{{description}}}
{{/description}}

module {
    // User-facing type: what application code uses
    public type {{classname}} = {
{{#vars}}
        {{#description}}
        /// {{{description}}}
        {{/description}}
        {{name}} : {{^required}}?{{/required}}{{{dataType}}};
{{/vars}}
    };

    // JSON sub-module: everything needed for JSON serialization
    public module JSON {
        // JSON-facing Motoko type: mirrors JSON structure
        // Named "JSON" to avoid shadowing the outer {{classname}} type
        public type JSON = {
{{#vars}}
            {{name}} : {{^required}}?{{/required}}{{#isEnumRef}}{{{datatypeWithEnum}}}.JSON{{/isEnumRef}}{{^isEnumRef}}{{#vendorExtensions.xNeedsJsonConversion}}{{{dataType}}}.JSON{{/vendorExtensions.xNeedsJsonConversion}}{{^vendorExtensions.xNeedsJsonConversion}}{{#vendorExtensions.x-is-unsigned}}Int{{/vendorExtensions.x-is-unsigned}}{{^vendorExtensions.x-is-unsigned}}{{{dataType}}}{{/vendorExtensions.x-is-unsigned}}{{/vendorExtensions.xNeedsJsonConversion}}{{/isEnumRef}};
{{/vars}}
        };

        // Convert User-facing type to JSON-facing Motoko type
        public func toJSON(value : {{classname}}) : JSON = {{#vendorExtensions.xNoEnumFields}}value{{/vendorExtensions.xNoEnumFields}}{{^vendorExtensions.xNoEnumFields}}{{#vendorExtensions.xHasPartialTransform}}{ value with
{{#vars}}
{{#isEnumRef}}
            {{name}} = {{#required}}{{{datatypeWithEnum}}}.toJSON(value.{{name}}){{/required}}{{^required}}switch (value.{{name}}) { case (?v) ?{{{datatypeWithEnum}}}.toJSON(v); case null null }{{/required}};
{{/isEnumRef}}
{{^isEnumRef}}
{{#vendorExtensions.xNeedsJsonConversion}}
            {{name}} = {{#required}}{{{dataType}}}.toJSON(value.{{name}}){{/required}}{{^required}}switch (value.{{name}}) { case (?v) ?{{{dataType}}}.toJSON(v); case null null }{{/required}};
{{/vendorExtensions.xNeedsJsonConversion}}
{{/isEnumRef}}
{{/vars}}
        }{{/vendorExtensions.xHasPartialTransform}}{{^vendorExtensions.xHasPartialTransform}}{
{{#vars}}
            {{name}} = {{#required}}{{#isEnumRef}}{{{datatypeWithEnum}}}.toJSON(value.{{name}}){{/isEnumRef}}{{^isEnumRef}}{{#vendorExtensions.xNeedsJsonConversion}}{{{dataType}}}.toJSON(value.{{name}}){{/vendorExtensions.xNeedsJsonConversion}}{{^vendorExtensions.xNeedsJsonConversion}}value.{{name}}{{/vendorExtensions.xNeedsJsonConversion}}{{/isEnumRef}}{{/required}}{{^required}}{{#isEnumRef}}switch (value.{{name}}) { case (?v) ?{{{datatypeWithEnum}}}.toJSON(v); case null null }{{/isEnumRef}}{{^isEnumRef}}{{#vendorExtensions.xNeedsJsonConversion}}switch (value.{{name}}) { case (?v) ?{{{dataType}}}.toJSON(v); case null null }{{/vendorExtensions.xNeedsJsonConversion}}{{^vendorExtensions.xNeedsJsonConversion}}value.{{name}}{{/vendorExtensions.xNeedsJsonConversion}}{{/isEnumRef}}{{/required}};
{{/vars}}
        }{{/vendorExtensions.xHasPartialTransform}}{{/vendorExtensions.xNoEnumFields}};

        // Convert JSON-facing Motoko type to User-facing type
        public func fromJSON(json : JSON) : ?{{classname}} {{#vendorExtensions.xNoEnumFields}}= ?json{{/vendorExtensions.xNoEnumFields}}{{^vendorExtensions.xNoEnumFields}}{{#vendorExtensions.xHasPartialTransform}}{
{{#vars}}
{{#required}}
{{#isEnumRef}}
            let ?{{name}} = {{{datatypeWithEnum}}}.fromJSON(json.{{name}}) else return null;
{{/isEnumRef}}
{{^isEnumRef}}
{{#vendorExtensions.xNeedsJsonConversion}}
            let ?{{name}} = {{{dataType}}}.fromJSON(json.{{name}}) else return null;
{{/vendorExtensions.xNeedsJsonConversion}}
{{/isEnumRef}}
{{/required}}
{{/vars}}
            ?{ json with
{{#vars}}
{{#isEnumRef}}
                {{name}}{{#required}}{{/required}}{{^required}} = switch (json.{{name}}) { case (?v) {{{datatypeWithEnum}}}.fromJSON(v); case null null }{{/required}};
{{/isEnumRef}}
{{^isEnumRef}}
{{#vendorExtensions.xNeedsJsonConversion}}
                {{name}}{{#required}}{{/required}}{{^required}} = switch (json.{{name}}) { case (?v) {{{dataType}}}.fromJSON(v); case null null }{{/required}};
{{/vendorExtensions.xNeedsJsonConversion}}
{{^vendorExtensions.xNeedsJsonConversion}}
{{#vendorExtensions.x-is-unsigned}}
                {{name}}{{#required}} = if (json.{{name}} < 0) return null else Int.abs(json.{{name}}){{/required}}{{^required}} = switch (json.{{name}}) { case (?v) if (v < 0) null else ?Int.abs(v); case null null }{{/required}};
{{/vendorExtensions.x-is-unsigned}}
{{/vendorExtensions.xNeedsJsonConversion}}
{{/isEnumRef}}
{{/vars}}
            }
        }{{/vendorExtensions.xHasPartialTransform}}{{^vendorExtensions.xHasPartialTransform}}{
{{#vars}}
{{#required}}
{{#isEnumRef}}
            let ?{{name}} = {{{datatypeWithEnum}}}.fromJSON(json.{{name}}) else return null;
{{/isEnumRef}}
{{^isEnumRef}}
{{#vendorExtensions.xNeedsJsonConversion}}
            let ?{{name}} = {{{dataType}}}.fromJSON(json.{{name}}) else return null;
{{/vendorExtensions.xNeedsJsonConversion}}
{{/isEnumRef}}
{{/required}}
{{/vars}}
            ?{
{{#vars}}
                {{name}}{{#required}}{{^isEnumRef}}{{^vendorExtensions.xNeedsJsonConversion}}{{#vendorExtensions.x-is-unsigned}} = if (json.{{name}} < 0) return null else Int.abs(json.{{name}}){{/vendorExtensions.x-is-unsigned}}{{^vendorExtensions.x-is-unsigned}} = json.{{name}}{{/vendorExtensions.x-is-unsigned}}{{/vendorExtensions.xNeedsJsonConversion}}{{/isEnumRef}}{{/required}}{{^required}} = {{#isEnumRef}}switch (json.{{name}}) { case (?v) {{{datatypeWithEnum}}}.fromJSON(v); case null null }{{/isEnumRef}}{{^isEnumRef}}{{#vendorExtensions.xNeedsJsonConversion}}switch (json.{{name}}) { case (?v) {{{dataType}}}.fromJSON(v); case null null }{{/vendorExtensions.xNeedsJsonConversion}}{{^vendorExtensions.xNeedsJsonConversion}}{{#vendorExtensions.x-is-unsigned}}switch (json.{{name}}) { case (?v) if (v < 0) null else ?Int.abs(v); case null null }{{/vendorExtensions.x-is-unsigned}}{{^vendorExtensions.x-is-unsigned}}json.{{name}}{{/vendorExtensions.x-is-unsigned}}{{/vendorExtensions.xNeedsJsonConversion}}{{/isEnumRef}}{{/required}};
{{/vars}}
            }
        }{{/vendorExtensions.xHasPartialTransform}}{{/vendorExtensions.xNoEnumFields}};
    }
}
{{/vendorExtensions.x-is-oneof}}
{{/isEnum}}
{{/model}}
{{/models}}
